<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia de Desparasita√ß√£o do Coelho Dom√©stico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Chosen Palette: Nature & Calm -->
    <!-- Primary: #4ADE80 (Green-400) for safe/positive actions -->
    <!-- Secondary: #FCD34D (Amber-300) for warnings -->
    <!-- Background: #FAFAF9 (Warm Gray/Stone) -->
    <!-- Text: #1C1917 (Stone-900) -->

    <style>
        body { font-family: 'Nunito', sans-serif; background-color: #FAFAF9; color: #1C1917; }
        .chart-container { 
            position: relative; 
            width: 100%; 
            max-width: 600px; 
            margin: 0 auto; 
            height: 300px; 
            max-height: 400px; 
        }
        .card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .active-tab {
            border-bottom: 3px solid #16A34A;
            color: #16A34A;
            font-weight: 700;
        }
        .hidden-section { display: none; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* Utility for button states in calculator */
        .btn-selected {
            background-color: #DCFCE7; /* Green-100 */
            border-color: #22C55E; /* Green-500 */
            color: #14532D; /* Green-900 */
            font-weight: 700;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Navigation -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-2xl text-green-600 mr-2">üê∞</span>
                    <h1 class="text-xl font-bold tracking-tight text-stone-800">CoelhoSaud√°vel <span class="text-stone-400 font-light hidden sm:inline">| Investiga√ß√£o Antiparasit√°ria</span></h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="switchTab('dashboard')" id="nav-dashboard" class="px-3 py-2 text-sm font-medium active-tab transition-colors">Vis√£o Geral</button>
                    <button onclick="switchTab('calculator')" id="nav-calculator" class="px-3 py-2 text-sm font-medium text-stone-500 hover:text-green-600 transition-colors">Calculadora de Risco</button>
                    <button onclick="switchTab('analysis')" id="nav-analysis" class="px-3 py-2 text-sm font-medium text-stone-500 hover:text-green-600 transition-colors">Dados & Ci√™ncia</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">

        <!-- VIEW 1: DASHBOARD (Overview) -->
        <div id="dashboard" class="fade-in space-y-8">
            
            <!-- Hero Insight -->
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden border-l-4 border-green-500">
                <div class="p-6 md:p-8">
                    <h2 class="text-2xl font-bold text-stone-800 mb-4">Veredito R√°pido: Devo dar "Telmi" de vez em quando?</h2>
                    <p class="text-lg text-stone-600 mb-6 leading-relaxed">
                        A resposta curta √©: <strong>Depende, mas provavelmente n√£o como rotina cega.</strong> 
                        A desparasita√ß√£o moderna em coelhos n√£o √© feita "por calend√°rio" como em c√£es. 
                        O foco deve ser a preven√ß√£o do <em>E. cuniculi</em> (onde o "Telmi" pode n√£o ser o mais eficaz) e exames de fezes para parasitas intestinais.
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-stone-50 p-4 rounded-lg border border-stone-200">
                            <h3 class="font-bold text-stone-700 mb-2">üö´ N√£o d√™ por dar</h3>
                            <p class="text-sm text-stone-600">Desparasitantes qu√≠micos sobrecarregam o f√≠gado. S√≥ use se houver risco confirmado ou protocolo de chegada.</p>
                        </div>
                        <div class="bg-amber-50 p-4 rounded-lg border border-amber-200">
                            <h3 class="font-bold text-amber-800 mb-2">‚ö†Ô∏è Cuidado com "Telmi"</h3>
                            <p class="text-sm text-amber-800">"Telmi" (Mebendazol) √© diferente de Panacur (Fenbendazol). O Fenbendazol √© o padr√£o para o parasita mais perigoso.</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                            <h3 class="font-bold text-green-800 mb-2">‚úÖ O Protocolo de Ouro</h3>
                            <p class="text-sm text-green-800">Exame de fezes anual + Ciclo preventivo de 28 dias de Fenbendazol ao adotar um novo coelho.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- The "Telmi" Breakdown Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Text Content -->
                <div class="bg-white rounded-2xl shadow p-6">
                    <h3 class="text-xl font-bold text-stone-800 mb-4">A Confus√£o dos Medicamentos</h3>
                    <p class="text-stone-600 mb-4">
                        Muitos tutores usam o termo "Telmi" referindo-se a pastas orais comuns (como Telmin). 
                        √â crucial entender a diferen√ßa qu√≠mica, pois coelhos t√™m sensibilidades espec√≠ficas.
                    </p>
                    
                    <div class="space-y-4">
                        <div class="flex items-start">
                            <div class="flex-shrink-0 h-10 w-10 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 font-bold">M</div>
                            <div class="ml-4">
                                <h4 class="text-lg font-bold text-stone-800">Mebendazol ("Telmi")</h4>
                                <p class="text-sm text-stone-500">Eficaz contra vermes intestinais (nematodes). Menos eficaz contra o parasita neurol√≥gico <em>E. cuniculi</em>. Pode causar toxicidade na medula √≥ssea em doses erradas.</p>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <div class="flex-shrink-0 h-10 w-10 rounded-full bg-green-100 flex items-center justify-center text-green-600 font-bold">F</div>
                            <div class="ml-4">
                                <h4 class="text-lg font-bold text-stone-800">Fenbendazol (Panacur)</h4>
                                <p class="text-sm text-stone-500">A escolha #1 de veterin√°rios de ex√≥ticos. Trata vermes intestinais E penetra a barreira hematoencef√°lica para tratar/prevenir <em>E. cuniculi</em>. Mais seguro.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Interactive Comparative Chart -->
                <div class="bg-white rounded-2xl shadow p-6 flex flex-col justify-center">
                    <h3 class="text-lg font-bold text-stone-800 mb-2 text-center">Espectro de A√ß√£o</h3>
                    <div class="chart-container">
                        <canvas id="efficacyChart"></canvas>
                    </div>
                    <p class="text-xs text-center text-stone-400 mt-2">Dados baseados em literatura veterin√°ria de animais ex√≥ticos.</p>
                </div>
            </div>

            <!-- Warning Signs -->
            <div class="bg-stone-800 text-white rounded-2xl shadow-lg p-8">
                <div class="md:flex md:items-center md:justify-between">
                    <div class="mb-6 md:mb-0 md:w-2/3">
                        <h3 class="text-2xl font-bold mb-2">Sintomas de Alerta</h3>
                        <p class="text-stone-300">Se o seu coelho apresentar qualquer um destes sinais, a desparasita√ß√£o "caseira" n√£o √© suficiente. Consulte um veterin√°rio imediatamente.</p>
                    </div>
                    <div class="md:w-1/3 flex justify-end">
                        <button onclick="switchTab('calculator')" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full transition-all shadow-lg transform hover:scale-105">
                            Verificar o meu Coelho
                        </button>
                    </div>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8">
                    <div class="bg-stone-700 p-3 rounded text-center">
                        <span class="block text-2xl mb-1">ü§ï</span>
                        <span class="text-sm font-semibold">Cabe√ßa Torta</span>
                    </div>
                    <div class="bg-stone-700 p-3 rounded text-center">
                        <span class="block text-2xl mb-1">üíß</span>
                        <span class="text-sm font-semibold">Beber/Urinar Muito</span>
                    </div>
                    <div class="bg-stone-700 p-3 rounded text-center">
                        <span class="block text-2xl mb-1">üìâ</span>
                        <span class="text-sm font-semibold">Perda de Peso</span>
                    </div>
                    <div class="bg-stone-700 p-3 rounded text-center">
                        <span class="block text-2xl mb-1">üí©</span>
                        <span class="text-sm font-semibold">Fezes Moles</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW 2: CALCULATOR (Risk Assessment) -->
        <div id="calculator" class="hidden-section fade-in">
            <div class="max-w-3xl mx-auto">
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
                    <div class="bg-green-600 p-6">
                        <h2 class="text-2xl font-bold text-white">Calculadora de Necessidade</h2>
                        <p class="text-green-100 mt-2">Responda a 4 perguntas para receber uma recomenda√ß√£o t√©cnica.</p>
                    </div>
                    
                    <div class="p-8 space-y-8">
                        <!-- Question 1 -->
                        <div class="border-b border-stone-100 pb-6">
                            <label class="block text-lg font-medium text-stone-800 mb-4">1. O seu coelho tem acesso ao exterior (jardim, terra)?</label>
                            <div class="flex space-x-4">
                                <button onclick="setRisk('outdoor', true, this)" class="risk-btn-1 flex-1 py-3 border-2 border-stone-200 rounded-lg hover:border-green-500 transition-all font-semibold text-stone-600">Sim, vai √† rua</button>
                                <button onclick="setRisk('outdoor', false, this)" class="risk-btn-1 flex-1 py-3 border-2 border-stone-200 rounded-lg hover:border-green-500 transition-all font-semibold text-stone-600">N√£o, √© 100% interior</button>
                            </div>
                        </div>

                        <!-- Question 2 (UPDATED WITH RABBIT OPTION) -->
                        <div class="border-b border-stone-100 pb-6">
                            <label class="block text-lg font-medium text-stone-800 mb-4">2. Convive com outros animais diariamente?</label>
                            <p class="text-sm text-stone-400 mb-3">O tipo de animal influencia o risco de cont√°gio.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <button onclick="setRisk('social', 'none', this)" class="risk-btn-2 py-3 border-2 border-stone-200 rounded-lg hover:border-green-500 transition-all font-semibold text-stone-600">N√£o, vive sozinho</button>
                                <button onclick="setRisk('social', 'rabbits', this)" class="risk-btn-2 py-3 border-2 border-stone-200 rounded-lg hover:border-green-500 transition-all font-semibold text-stone-600">Sim, com outros coelhos</button>
                                <button onclick="setRisk('social', 'pets', this)" class="risk-btn-2 py-3 border-2 border-stone-200 rounded-lg hover:border-green-500 transition-all font-semibold text-stone-600">Sim, c√£es ou gatos</button>
                                <button onclick="setRisk('social', 'mixed', this)" class="risk-btn-2 py-3 border-2 border-stone-200 rounded-lg hover:border-green-500 transition-all font-semibold text-stone-600">Sim, v√°rias esp√©cies</button>
                            </div>
                        </div>

                        <!-- Question 3 (UPDATED GAP) -->
                        <div class="border-b border-stone-100 pb-6">
                            <label class="block text-lg font-medium text-stone-800 mb-4">3. Quando foi a √∫ltima desparasita√ß√£o preventiva?</label>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <button onclick="setRisk('time', 'recent', this)" class="risk-btn-3 py-3 border-2 border-stone-200 rounded-lg hover:border-green-500 transition-all font-semibold text-stone-600">H√° menos de 6 meses</button>
                                <button onclick="setRisk('time', 'medium', this)" class="risk-btn-3 py-3 border-2 border-stone-200 rounded-lg hover:border-green-500 transition-all font-semibold text-stone-600">Entre 6 e 12 meses</button>
                                <button onclick="setRisk('time', 'old', this)" class="risk-btn-3 py-3 border-2 border-stone-200 rounded-lg hover:border-green-500 transition-all font-semibold text-stone-600">H√° mais de 1 ano / Nunca</button>
                            </div>
                        </div>

                        <!-- Question 4 -->
                        <div class="pb-6">
                            <label class="block text-lg font-medium text-stone-800 mb-4">4. O coelho √© novo em casa (adotado recentemente)?</label>
                            <div class="flex space-x-4">
                                <button onclick="setRisk('new', true, this)" class="risk-btn-4 flex-1 py-3 border-2 border-stone-200 rounded-lg hover:border-green-500 transition-all font-semibold text-stone-600">Sim, chegou agora</button>
                                <button onclick="setRisk('new', false, this)" class="risk-btn-4 flex-1 py-3 border-2 border-stone-200 rounded-lg hover:border-green-500 transition-all font-semibold text-stone-600">J√° vive comigo h√° muito</button>
                            </div>
                        </div>

                        <button onclick="calculateRecommendation()" class="w-full bg-stone-800 hover:bg-stone-900 text-white font-bold py-4 rounded-xl text-lg transition-all shadow-lg">Obter Recomenda√ß√£o</button>
                    </div>

                    <!-- Result Area (Hidden by default) -->
                    <div id="calculator-result" class="hidden bg-stone-50 p-8 border-t border-stone-200">
                        <div id="result-header" class="text-xl font-bold mb-4"></div>
                        <p id="result-body" class="text-stone-700 mb-6"></p>
                        
                        <div class="bg-white p-4 rounded-lg border border-stone-200 shadow-sm">
                            <h4 class="font-bold text-stone-800 mb-2">Plano Sugerido:</h4>
                            <ul id="result-plan" class="list-disc list-inside text-stone-600 space-y-2"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW 3: ANALYSIS (Data & Deep Dive) -->
        <div id="analysis" class="hidden-section fade-in space-y-8">
            <div class="bg-white p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-bold text-stone-800 mb-4">Por que nos preocupamos com o <em>E. cuniculi</em>?</h2>
                <p class="text-stone-600 mb-8 max-w-3xl">
                    A maioria dos coelhos dom√©sticos n√£o tem vermes intestinais vis√≠veis porque vivem dentro de casa. 
                    No entanto, o <em>Encephalitozoon cuniculi</em> √© um parasita microsc√≥pico "silencioso" que pode causar doen√ßas renais e neurol√≥gicas graves.
                    Ao contr√°rio dos vermes, ele n√£o sai nas fezes regularmente, tornando o exame fecal dif√≠cil.
                </p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                    <div class="chart-container">
                        <canvas id="prevalenceChart"></canvas>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-stone-800 mb-4">Realidade Estat√≠stica</h3>
                        <ul class="space-y-4">
                            <li class="flex items-start">
                                <span class="bg-red-100 text-red-600 rounded-full p-1 mr-3 text-xs font-bold w-6 h-6 flex items-center justify-center">1</span>
                                <p class="text-sm text-stone-600"><strong>Alta Exposi√ß√£o:</strong> Estudos mostram que at√© 70% dos coelhos dom√©sticos t√™m anticorpos para <em>E. cuniculi</em>, indicando exposi√ß√£o pr√©via.</p>
                            </li>
                            <li class="flex items-start">
                                <span class="bg-orange-100 text-orange-600 rounded-full p-1 mr-3 text-xs font-bold w-6 h-6 flex items-center justify-center">2</span>
                                <p class="text-sm text-stone-600"><strong>Lat√™ncia:</strong> A maioria dos coelhos √© portadora assintom√°tica. O estresse (mudan√ßa de casa, doen√ßa) pode ativar o parasita.</p>
                            </li>
                            <li class="flex items-start">
                                <span class="bg-green-100 text-green-600 rounded-full p-1 mr-3 text-xs font-bold w-6 h-6 flex items-center justify-center">3</span>
                                <p class="text-sm text-stone-600"><strong>Preven√ß√£o:</strong> √â por isso que recomendamos um ciclo de 28 dias de Fenbendazol (Panacur) 1 a 2 vezes por ano, ou na chegada de um novo coelho.</p>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Parasite Cards -->
            <h3 class="text-2xl font-bold text-stone-800 mt-12 mb-6">Conhe√ßa os Inimigos</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Card 1 -->
                <div class="card bg-white rounded-xl overflow-hidden shadow border border-stone-100">
                    <div class="bg-purple-100 p-4 flex justify-between items-center">
                        <h4 class="font-bold text-purple-900">E. cuniculi</h4>
                        <span class="text-2xl">üß†</span>
                    </div>
                    <div class="p-6">
                        <p class="text-sm text-stone-600 mb-4">Microspor√≠dio intracelular. Afeta sistema nervoso e rins.</p>
                        <div class="text-xs font-semibold uppercase text-stone-400 mb-1">Tratamento Ideal</div>
                        <div class="text-purple-700 font-bold mb-4">Fenbendazol (28 dias)</div>
                        <div class="text-xs font-semibold uppercase text-stone-400 mb-1">Efic√°cia do "Telmi"</div>
                        <div class="w-full bg-stone-200 rounded-full h-2">
                            <div class="bg-purple-400 h-2 rounded-full" style="width: 30%"></div>
                        </div>
                        <span class="text-xs text-stone-500">Baixa/Incerta</span>
                    </div>
                </div>

                <!-- Card 2 -->
                <div class="card bg-white rounded-xl overflow-hidden shadow border border-stone-100">
                    <div class="bg-blue-100 p-4 flex justify-between items-center">
                        <h4 class="font-bold text-blue-900">Cocc√≠dias</h4>
                        <span class="text-2xl">ü¶†</span>
                    </div>
                    <div class="p-6">
                        <p class="text-sm text-stone-600 mb-4">Protozo√°rios intestinais. Causam diarreia grave em jovens.</p>
                        <div class="text-xs font-semibold uppercase text-stone-400 mb-1">Tratamento Ideal</div>
                        <div class="text-blue-700 font-bold mb-4">Toltrazuril (Baycox)</div>
                        <div class="text-xs font-semibold uppercase text-stone-400 mb-1">Efic√°cia do "Telmi"</div>
                        <div class="w-full bg-stone-200 rounded-full h-2">
                            <div class="bg-blue-400 h-2 rounded-full" style="width: 5%"></div>
                        </div>
                        <span class="text-xs text-stone-500">Nula</span>
                    </div>
                </div>

                <!-- Card 3 -->
                <div class="card bg-white rounded-xl overflow-hidden shadow border border-stone-100">
                    <div class="bg-orange-100 p-4 flex justify-between items-center">
                        <h4 class="font-bold text-orange-900">Oxi√∫ros (Vermes)</h4>
                        <span class="text-2xl">ü™±</span>
                    </div>
                    <div class="p-6">
                        <p class="text-sm text-stone-600 mb-4">Vermes vis√≠veis nas fezes. Comuns e menos perigosos.</p>
                        <div class="text-xs font-semibold uppercase text-stone-400 mb-1">Tratamento Ideal</div>
                        <div class="text-orange-700 font-bold mb-4">Fenbendazol ou Mebendazol</div>
                        <div class="text-xs font-semibold uppercase text-stone-400 mb-1">Efic√°cia do "Telmi"</div>
                        <div class="w-full bg-stone-200 rounded-full h-2">
                            <div class="bg-orange-400 h-2 rounded-full" style="width: 90%"></div>
                        </div>
                        <span class="text-xs text-stone-500">Alta</span>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-stone-900 text-stone-400 py-8 mt-12">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="mb-2">‚ö†Ô∏è <strong>Aviso Importante:</strong> Esta ferramenta √© informativa.</p>
            <p class="text-sm">Nunca medique o seu animal sem consultar um m√©dico veterin√°rio especializado em animais ex√≥ticos. As dosagens de c√£es/gatos podem ser fatais para coelhos.</p>
        </div>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        // --- State Management ---
        const state = {
            riskAnswers: {
                outdoor: null,
                social: null, // Changed from boolean to string
                time: null,   // String: 'recent', 'medium', 'old'
                new: null
            },
            currentTab: 'dashboard'
        };

        // --- Navigation Logic ---
        function switchTab(tabId) {
            // Hide all sections
            document.getElementById('dashboard').classList.add('hidden-section');
            document.getElementById('calculator').classList.add('hidden-section');
            document.getElementById('analysis').classList.add('hidden-section');

            // Reset Tab Styles
            document.getElementById('nav-dashboard').className = "px-3 py-2 text-sm font-medium text-stone-500 hover:text-green-600 transition-colors";
            document.getElementById('nav-calculator').className = "px-3 py-2 text-sm font-medium text-stone-500 hover:text-green-600 transition-colors";
            document.getElementById('nav-analysis').className = "px-3 py-2 text-sm font-medium text-stone-500 hover:text-green-600 transition-colors";

            // Show Selected
            document.getElementById(tabId).classList.remove('hidden-section');
            document.getElementById('nav-' + tabId).className = "px-3 py-2 text-sm font-medium active-tab transition-colors";
            
            state.currentTab = tabId;

            // Trigger chart resize if needed
            if (tabId === 'dashboard') {
                updateEfficacyChart();
            } else if (tabId === 'analysis') {
                updatePrevalenceChart();
            }
        }

        // --- Calculator Logic ---
        function setRisk(key, value, btnElement) {
            state.riskAnswers[key] = value;
            
            // UI Feedback
            let groupClass;
            if (key === 'time') groupClass = '.risk-btn-3';
            else if (key === 'outdoor') groupClass = '.risk-btn-1';
            else if (key === 'social') groupClass = '.risk-btn-2';
            else groupClass = '.risk-btn-4';

            // Reset siblings
            const siblings = document.querySelectorAll(groupClass);
            siblings.forEach(btn => {
                btn.classList.remove('btn-selected');
                btn.classList.add('border-stone-200', 'text-stone-600');
            });

            // Highlight selected
            btnElement.classList.remove('border-stone-200', 'text-stone-600');
            btnElement.classList.add('btn-selected');
        }

        function calculateRecommendation() {
            const answers = state.riskAnswers;
            const resultDiv = document.getElementById('calculator-result');
            const header = document.getElementById('result-header');
            const body = document.getElementById('result-body');
            const plan = document.getElementById('result-plan');

            if (Object.values(answers).includes(null)) {
                alert("Por favor, responda a todas as perguntas.");
                return;
            }

            resultDiv.classList.remove('hidden');
            plan.innerHTML = ''; // Clear previous

            // SCORING LOGIC UPDATED
            let score = 0;
            
            if (answers.outdoor) score += 2; // Outdoor risk

            // Social Risk (Specific weights)
            if (answers.social === 'rabbits') score += 4; // High E.cuniculi risk
            else if (answers.social === 'pets') score += 1; // Moderate risk
            else if (answers.social === 'mixed') score += 4; // High risk
            
            if (answers.new) score += 3; // New addition risk

            // Time Risk (Gap fixed)
            if (answers.time === 'medium') score += 1; // 6-12 months
            if (answers.time === 'old') score += 2; // >1 year

            // Logic Tree
            if (answers.new) {
                // Scenario: New Rabbit (Top Priority)
                resultDiv.className = "bg-green-50 p-8 border-t border-green-200 mt-6 rounded-b-2xl";
                header.textContent = "Recomenda√ß√£o: Protocolo de Chegada";
                header.className = "text-xl font-bold mb-4 text-green-800";
                body.textContent = "Coelhos rec√©m-adotados trazem hist√≥rico desconhecido. A mudan√ßa de ambiente causa estresse, baixando a imunidade e ativando parasitas latentes como E. cuniculi.";
                
                addPlanItem(plan, "Fazer ciclo de Fenbendazol (Panacur) durante 28 dias imediatamente.");
                addPlanItem(plan, "Recolher amostra de fezes (3 dias seguidos) para an√°lise de cocc√≠dias.");
                addPlanItem(plan, "Aten√ß√£o: Se tem outros coelhos, o conv√≠vio s√≥ deve come√ßar ap√≥s quarentena.");

            } else if (score >= 4) {
                // Scenario: High Risk Maintenance (Lowered threshold slightly due to social weight)
                resultDiv.className = "bg-amber-50 p-8 border-t border-amber-200 mt-6 rounded-b-2xl";
                header.textContent = "Recomenda√ß√£o: Alta Vigil√¢ncia";
                header.className = "text-xl font-bold mb-4 text-amber-800";
                body.innerHTML = "O seu coelho tem fatores de risco significativos. <br><strong>Motivo principal:</strong> " + 
                    (answers.social === 'rabbits' ? "Conv√≠vio com outros coelhos aumenta drasticamente o risco de transmiss√£o silenciosa." : 
                     answers.outdoor ? "Acesso ao exterior exp√µe a parasitas de solo." : "V√°rios fatores combinados.");
                
                addPlanItem(plan, "Desparasita√ß√£o preventiva para E. cuniculi (28 dias) a cada 6 meses.");
                addPlanItem(plan, "Exame de fezes a cada 6 meses para vermes intestinais.");
                addPlanItem(plan, "Se vivem coelhos juntos, devem ser desparasitados todos ao mesmo tempo.");

            } else if (answers.time === 'medium') {
                // Scenario: Warning Gap
                resultDiv.className = "bg-blue-50 p-8 border-t border-blue-200 mt-6 rounded-b-2xl";
                header.textContent = "Recomenda√ß√£o: Check-up Necess√°rio";
                header.className = "text-xl font-bold mb-4 text-blue-800";
                body.textContent = "Passaram-se entre 6 a 12 meses. Embora o risco seja moderado, √© a altura ideal para confirmar que tudo est√° bem antes de medicar.";

                addPlanItem(plan, "Realizar exame de fezes para despiste.");
                addPlanItem(plan, "Se negativo, n√£o medicar 'por rotina'.");
                addPlanItem(plan, "Reforce a higiene da litiera.");

            } else {
                // Scenario: Low Risk
                resultDiv.className = "bg-stone-100 p-8 border-t border-stone-200 mt-6 rounded-b-2xl";
                header.textContent = "Recomenda√ß√£o: Baixa Interven√ß√£o";
                header.className = "text-xl font-bold mb-4 text-stone-800";
                body.textContent = "Sendo um coelho de interior, sem novos contactos e com hist√≥rico est√°vel, o risco de apanhar vermes novos √© baixo.";

                addPlanItem(plan, "N√£o d√™ 'Telmi' ou desparasitantes de rotina.");
                addPlanItem(plan, "Fa√ßa ciclo de E. cuniculi (Fenbendazol) 1 vez por ano apenas por precau√ß√£o.");
                addPlanItem(plan, "Leve fezes para an√°lise no check-up anual de vacina√ß√£o.");
            }
        }

        function addPlanItem(list, text) {
            const li = document.createElement('li');
            li.textContent = text;
            list.appendChild(li);
        }

        // --- Charts Implementation ---
        let efficacyChartInstance = null;
        let prevalenceChartInstance = null;

        function updateEfficacyChart() {
            const ctx = document.getElementById('efficacyChart').getContext('2d');
            
            if (efficacyChartInstance) return; // Already created

            efficacyChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Vermes Intestinais (Nematodes)', 'E. cuniculi (Neurol√≥gico)', 'Cocc√≠dias'],
                    datasets: [
                        {
                            label: 'Mebendazol ("Telmi")',
                            data: [90, 20, 0],
                            backgroundColor: 'rgba(245, 158, 11, 0.7)', // Amber
                            borderColor: 'rgba(245, 158, 11, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Fenbendazol (Panacur)',
                            data: [95, 95, 0],
                            backgroundColor: 'rgba(22, 163, 74, 0.7)', // Green
                            borderColor: 'rgba(22, 163, 74, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: { display: true, text: '% Efic√°cia Estimada' }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                footer: (items) => {
                                    if(items[0].label.includes('Cocc√≠dias')) return 'Requer Toltrazuril (Baycox)';
                                    return '';
                                }
                            }
                        }
                    }
                }
            });
        }

        function updatePrevalenceChart() {
            const ctx = document.getElementById('prevalenceChart').getContext('2d');
            
            if (prevalenceChartInstance) return;

            prevalenceChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Expostos (Anticorpos Positivos)', 'N√£o Expostos'],
                    datasets: [{
                        data: [60, 40],
                        backgroundColor: [
                            'rgba(239, 68, 68, 0.7)', // Red
                            'rgba(209, 213, 219, 0.5)' // Gray
                        ],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Preval√™ncia de E. cuniculi em Coelhos Dom√©sticos',
                            font: { size: 16 }
                        },
                        subtitle: {
                            display: true,
                            text: 'Muitos coelhos t√™m o parasita "a dormir" no organismo',
                            padding: { bottom: 20 }
                        }
                    }
                }
            });
        }

        // Initialize Default View
        window.addEventListener('load', () => {
            updateEfficacyChart();
        });

    </script>
</body>
</html>
